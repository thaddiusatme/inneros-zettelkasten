# GitHub Issue: Persist `process-note` Outputs (Phase 2–3)

> **Copy this to create a GitHub issue when `gh auth login` is configured**

---

## Title

Persist `suggested_links` + `## Suggested Connections` section for `process-note`

## Labels

Recommended (adjust if label names differ in GitHub):

`enhancement`, `priority:p0`, `size:small`

## Body

### Summary

`process-note` computes connection suggestions but does not persist them, so the user must rerun analysis to see actionable outputs.

Phase 1 persisted `triage_recommendation` (commit `0a7d3b3`). Phase 2–3 persists connection outputs so they become visible/queryable in Obsidian.

### Current State

- Connections exist in runtime results: `results["processing"]["connections"]["similar_notes"]`
- No persisted frontmatter field for suggested links
- No stable/replaceable body section for suggested connections

### Scope

**Phase 2 (P0)**: Persist `suggested_links` in YAML frontmatter.

**Phase 3 (P0)**: Append/replace a dedicated body section:

- Header: `## Suggested Connections`
- Include a timestamp line: `> Auto-generated by InnerOS on ...`
- Ensure idempotency: replace existing section, do not duplicate

### Detailed Requirements

#### Phase 2: `suggested_links` frontmatter

- Derive from discovered connections:
  - Source: `results["processing"]["connections"]["similar_notes"]`
- Persist as YAML list of **wikilink strings** (e.g., `[[Some Note]]`)
- Max 5 suggestions (configurable later)
- Deduplicate:
  - Against existing `suggested_links` in frontmatter
  - Against links already present in body
  - Within the newly generated list

#### Phase 3: `## Suggested Connections` section

- Append the section to end of note body
- If the section already exists, replace it
- Preserve all user-authored content outside the section

### Acceptance Criteria

- [ ] After `process-note`, frontmatter includes `suggested_links` (max 5, deduped)
- [ ] After `process-note`, the body contains **exactly one** `## Suggested Connections` section
- [ ] Re-processing is idempotent (frontmatter overwritten/updated, section replaced)
- [ ] Dry-run mode computes but does not persist changes
- [ ] Unit tests cover:
  - `suggested_links` persistence
  - section append
  - section replacement
  - dedupe behavior

### Implementation Notes

- Primary implementation target: `development/src/ai/note_processing_coordinator.py::process_note`
- If section manipulation grows beyond ~30–50 LOC, extract helpers into `development/src/utils/` with unit tests.

### Related Docs

- Prompt: `Projects/ACTIVE/prompt-phase-2-3-persist-links-and-body-section.md`
- Phase 1 lessons learned: `Projects/COMPLETED-2025-12/persist-triage-recommendation-phase-1-lessons-learned.md`

---

## Create Command

```bash
gh issue create \
  --title "Persist suggested_links + Suggested Connections section for process-note" \
  --label "enhancement,priority:p0,size:small" \
  --body-file Projects/ACTIVE/github-issue-persist-processing-results-phase-2-3-links-and-section.md
