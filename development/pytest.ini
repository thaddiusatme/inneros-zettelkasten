[pytest]
pythonpath = src
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Tiered timeout: 10s default (unit tests). Override per-test or per-class:
#   @pytest.mark.timeout(60)   — integration tests
#   @pytest.mark.timeout(300)  — smoke tests
timeout = 10

# Default profile: Fast dev mode without coverage (use --cov for coverage)
addopts = 
    -v
    --tb=short
    --strict-markers
    -m "not wip and not network"

# Marker definitions for auto-tagging (see conftest.py)
markers =
    fast: marks tests as fast unit tests (auto-applied to tests/unit/)
    integration: marks tests as integration tests (auto-applied to tests/integration/)
    fast_integration: marks integration tests <5s (isolated, no external APIs)
    slow_integration: marks integration tests with external API dependencies
    smoke: marks tests as smoke tests (auto-applied to tests/ root)
    ci: marks tests as CI-gating core workflow tests
    unit: marks tests as unit (deselect with '-m "not unit"')
    e2e: marks tests as end-to-end
    slow: marks tests as slow
    wip: marks tests as work-in-progress (deselect with '-m "not wip"')
    network: marks tests requiring network/localhost (excluded from fast pre-commit)

filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning

# CI Profile: Run with coverage
# Usage: pytest --cov=src --cov-report=term-missing --cov-report=html:htmlcov --cov-fail-under=80
#
# Common workflows:
#   Development (fast):  pytest -m fast              (unit tests, 10s timeout)
#   All tests (no cov):  pytest                      (excludes wip + network)
#   With coverage:       pytest --cov=src --cov-report=term-missing
#   Skip integration:    pytest -m "not integration"
#   Ollama tests:        pytest -m network            (opt-in, requires Ollama)
#   CI mode:             pytest --cov=src --cov-fail-under=80
#
# Fast Subset Definition (pre-commit):
#   The fast subset used by `pre-commit run pytest-unit-fast` excludes:
#   - @pytest.mark.slow: Long-running tests (>10s)
#   - @pytest.mark.network: Tests requiring localhost/network (can hang/timeout)
#   
#   Marker expression: -m "ci and not wip and not slow and not network"
#   
#   Rule: If a test can hang waiting for a server or network, mark it @network.
